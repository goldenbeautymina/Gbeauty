<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>çš‡å¸è©©å‘½é‹æ¸¬é©—ï½œGBeauty</title>

<style>
  body{margin:0;font-family:system-ui,-apple-system,"Noto Sans TC","Microsoft JhengHei",sans-serif;background:#faf7f2;color:#1f2937;line-height:1.6}
  .wrap{max-width:900px;margin:0 auto;padding:50px 20px 80px}
  h1{text-align:center;margin:0 0 8px;letter-spacing:.4px}
  .subtitle{text-align:center;font-size:14px;color:#4b5563;margin:0 0 26px}
  .card{background:#fff;border-radius:18px;padding:26px 22px;box-shadow:0 14px 35px rgba(0,0,0,.08)}
  label{font-weight:900;font-size:14px}
  .grid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
  @media(max-width:680px){.grid{grid-template-columns:1fr}}
  select,input,button{width:100%;margin-top:8px;padding:14px;border-radius:12px;border:1px solid #e5e7eb;font-size:16px;background:#fff;box-sizing:border-box}
  input::placeholder{color:#9ca3af}
  .btn{display:inline-flex;align-items:center;justify-content:center;padding:12px 16px;border-radius:999px;font-weight:900;text-decoration:none;border:1px solid #e5e7eb;color:#111827;background:#fff;cursor:pointer}
  .btn.primary{background:#111827;color:#fff;border-color:#111827}
  .btn:disabled{opacity:.6;cursor:not-allowed}
  .row{display:flex;flex-wrap:wrap;gap:10px;margin-top:14px}
  .mini{margin-top:8px;font-size:12px;color:#6b7280}
  .helper{margin-top:8px;font-size:12px;color:#6b7280}
  .note{margin-top:14px;font-size:14px;color:#4b5563;border-left:4px solid #b45309;padding:10px 12px;background:#fff7ed;border-radius:12px}
  .result{display:none;margin-top:26px;background:#fff;border-radius:18px;padding:26px 22px;box-shadow:0 14px 35px rgba(0,0,0,.08)}
  .badge{display:inline-block;padding:6px 10px;border-radius:999px;background:#111827;color:#fff;font-size:12px;font-weight:900;letter-spacing:.5px;margin-bottom:10px}
  .k{display:flex;flex-wrap:wrap;gap:8px;margin:10px 0 2px}
  .pill{display:inline-block;padding:6px 10px;border-radius:999px;border:1px solid #e5e7eb;font-size:12px;color:#374151;background:#fafafa}
  .ctaRow{display:flex;flex-wrap:wrap;gap:10px;margin-top:16px}

  /* âœ… å„€å¼æ–‡å­— */
  #ritualText{
    display:none;
    text-align:center;
    margin:20px 0 10px;
    color:#4b5563;
    font-size:15px;
    line-height:1.8;
  }

  /* âœ… 3 ç§’ç·©è¡å‹•ç•« */
  .loaderWrap{
    display:none;
    justify-content:center;
    align-items:center;
    gap:8px;
    margin:18px 0 6px;
  }
  .dot{
    width:8px;height:8px;border-radius:50%;
    background:#111827;opacity:.25;
    animation: pulse 1.4s infinite ease-in-out;
  }
  .dot:nth-child(2){animation-delay:.2s}
  .dot:nth-child(3){animation-delay:.4s}
  @keyframes pulse{
    0%,80%,100%{transform:scale(.6);opacity:.25}
    40%{transform:scale(1);opacity:.9}
  }
</style>
</head>

<body>
<div class="wrap">

  <h1>çš‡å¸è©©å‘½é‹æ¸¬é©—</h1>
  <div class="subtitle">å…ˆæŠŠçµæœå„²å­˜å¥½ï¼Œæˆ‘å†æŠŠç­”æ¡ˆæº«æŸ”åœ°äº¤çµ¦ä½ ã€‚</div>

  <div class="card">

    <div style="margin-bottom:14px;">
      <label for="custName">è«‹ç”¨å…¨å,ä¾†æ¢ç©¶ç”Ÿå‘½çš„èƒ½é‡</label>
      <input id="custName" placeholder="ä¾‹å¦‚ï¼šé™³åœ“åœ“" autocomplete="name">
      <div class="mini">æˆ‘åªç”¨ä¾†æ¨™è¨˜ä½ çš„æ¸¬é©—çµæœï¼Œæ–¹ä¾¿å¾ŒçºŒç‚ºä½ æ•´ç†èˆ‡å›è¦†ğŸ™‚</div>
    </div>

    <div class="grid">
      <div>
        <label for="season">ä½ çš„å‡ºç”Ÿå­£ç¯€ï¼ˆæ–°æ›†ï¼‰</label>
        <select id="season">
          <option value="">è«‹é¸æ“‡</option>
          <option value="spring">æ˜¥å­£ï¼ˆ2/4â€“5/5ï¼‰</option>
          <option value="summer">å¤å­£ï¼ˆ5/6â€“8/7ï¼‰</option>
          <option value="autumn">ç§‹å­£ï¼ˆ8/8â€“11/7ï¼‰</option>
          <option value="winter">å†¬å­£ï¼ˆ11/8â€“2/3ï¼‰</option>
        </select>
        <div class="helper">è‹¥ä½ ä¸ç¢ºå®šå­£ç¯€ï¼Œæˆ‘ä¹Ÿå¯ä»¥å¹«ä½ ç”¨ç”Ÿæ—¥æ›ç®—ã€‚</div>
      </div>

      <div>
        <label for="time">ä½ çš„å‡ºç”Ÿæ™‚è¾°</label>
        <select id="time">
          <option value="">è«‹é¸æ“‡</option>
          <option value="å­">å­æ™‚ï¼ˆ23:00â€“00:59ï¼‰</option>
          <option value="ä¸‘">ä¸‘æ™‚ï¼ˆ01:00â€“02:59ï¼‰</option>
          <option value="å¯…">å¯…æ™‚ï¼ˆ03:00â€“04:59ï¼‰</option>
          <option value="å¯">å¯æ™‚ï¼ˆ05:00â€“06:59ï¼‰</option>
          <option value="è¾°">è¾°æ™‚ï¼ˆ07:00â€“08:59ï¼‰</option>
          <option value="å·³">å·³æ™‚ï¼ˆ09:00â€“10:59ï¼‰</option>
          <option value="åˆ">åˆæ™‚ï¼ˆ11:00â€“12:59ï¼‰</option>
          <option value="æœª">æœªæ™‚ï¼ˆ13:00â€“14:59ï¼‰</option>
          <option value="ç”³">ç”³æ™‚ï¼ˆ15:00â€“16:59ï¼‰</option>
          <option value="é…‰">é…‰æ™‚ï¼ˆ17:00â€“18:59ï¼‰</option>
          <option value="æˆŒ">æˆŒæ™‚ï¼ˆ19:00â€“20:59ï¼‰</option>
          <option value="äº¥">äº¥æ™‚ï¼ˆ21:00â€“22:59ï¼‰</option>
        </select>
        <div class="helper">æ™‚è¾°ä»¥ã€Œå‡ºç”Ÿæ™‚é–“ã€ç‚ºæº–ã€‚</div>
      </div>
    </div>

    <div class="note">
      å°æé†’ï¼šé€™å€‹æ¸¬é©—çš„ç­”æ¡ˆæœƒå…ˆã€Œæ›¿ä½ è¨˜éŒ„ã€åˆ°è³‡æ–™åº«è£¡ã€‚<br>
      ä½ æŒ‰ä¸‹ã€Œå„²å­˜ä¸¦æ­æ›‰ã€å¾Œï¼Œè¡¨å–®æœƒè‡ªå‹•å¡«å¥½ï¼Œä½ åªè¦æŒ‰ä¸€æ¬¡ã€Œæäº¤ã€ï¼Œæˆ‘å°±èƒ½æŠŠç­”æ¡ˆå®Œæ•´ç•™å­˜ã€‚<br>
      âœ… æäº¤å¾Œå›åˆ°é€™é ï¼Œç›´æ¥æŒ‰ã€Œæˆ‘å·²æäº¤ï¼Œé¡¯ç¤ºçµæœã€å°±å¯ä»¥ã€‚
    </div>

    <div class="row">
      <button class="btn primary" id="btnSaveReveal" type="button" onclick="saveAndReveal()">å„²å­˜ä¸¦æ­æ›‰</button>
      <button class="btn" id="btnAlready" type="button" onclick="confirmSubmitted()" disabled>æˆ‘å·²æäº¤ï¼Œé¡¯ç¤ºçµæœ</button>
      <a class="btn" href="./">å›é¦–é </a>
    </div>

    <div class="mini" id="statusText"></div>
  </div>

  <div id="ritualText">
    è€å¸«å…ˆå¹«ä½ æŠŠä»Šå¤©çš„ç­”æ¡ˆæ”¶å¥½ã€‚<br>
    æˆ‘å€‘æ…¢æ…¢ä¾†ï¼Œè®“çµæœç”¨å‰›å‰›å¥½çš„é€Ÿåº¦å‡ºç¾ã€‚
  </div>
  <div id="loader" class="loaderWrap">
    <div class="dot"></div><div class="dot"></div><div class="dot"></div>
  </div>

  <div id="result" class="result"></div>

</div>

<script>
/** âœ… Google Formï¼ˆå«å§“å entryï¼‰ */
const FORM_BASE =
  "https://docs.google.com/forms/d/e/1FAIpQLSedMQBg5Bv2fXPYKtMamZr9sYaZ_mtBegk8KD1_-oqrh6c5BA/viewform?usp=pp_url"
  + "&entry.1299194271=NAME"
  + "&entry.115350540=SEASON"
  + "&entry.1352049654=TIME"
  + "&entry.569870339=PART"
  + "&entry.384840199=CONSULT";

/** âœ… å››å­£Ã—æ™‚è¾°â†’çš‡å¸éƒ¨ä½ï¼ˆâœ…ä¿®æ­£ï¼šç§»é™¤å¥‡æ€ªçš„ã€Œå·ã€ï¼‰ */
const table = {
  spring:{å­:"çš‡å¸é ­",å¯:"çš‡å¸è‚©",é…‰:"çš‡å¸è‚©",ä¸‘:"çš‡å¸è…¹",äº¥:"çš‡å¸è…¹",åˆ:"çš‡å¸è…°",å·³:"çš‡å¸æ‰‹",æœª:"çš‡å¸æ‰‹",è¾°:"çš‡å¸è†",æˆŒ:"çš‡å¸è†",å¯…:"çš‡å¸è¶³",ç”³:"çš‡å¸è¶³"},
  summer:{åˆ:"çš‡å¸é ­",å¯:"çš‡å¸è‚©",é…‰:"çš‡å¸è‚©",æœª:"çš‡å¸è…¹",äº¥:"çš‡å¸è…¹",å­:"çš‡å¸è…°",ä¸‘:"çš‡å¸æ‰‹",å·³:"çš‡å¸æ‰‹",è¾°:"çš‡å¸è†",æˆŒ:"çš‡å¸è†",å¯…:"çš‡å¸è¶³",ç”³:"çš‡å¸è¶³"},
  autumn:{äº¥:"çš‡å¸é ­",å­:"çš‡å¸è‚©",åˆ:"çš‡å¸è‚©",å¯:"çš‡å¸è…¹",æœª:"çš‡å¸è…¹",ç”³:"çš‡å¸è…°",ä¸‘:"çš‡å¸æ‰‹",å·³:"çš‡å¸æ‰‹",å¯…:"çš‡å¸è†",é…‰:"çš‡å¸è†",è¾°:"çš‡å¸è¶³",æˆŒ:"çš‡å¸è¶³"},
  winter:{å·³:"çš‡å¸é ­",å¯:"çš‡å¸è‚©",é…‰:"çš‡å¸è‚©",å¯…:"çš‡å¸è…¹",ç”³:"çš‡å¸è…¹",å­:"çš‡å¸è…°",åˆ:"çš‡å¸æ‰‹",äº¥:"çš‡å¸æ‰‹",ä¸‘:"çš‡å¸è†",æœª:"çš‡å¸è†",è¾°:"çš‡å¸è¶³",æˆŒ:"çš‡å¸è¶³"}
};

const consultMap = {
  "çš‡å¸é ­":"çœ‰ç‚ºä¸» Ã— çœ¼ç‚ºè¼”",
  "çš‡å¸è‚©":"çœ‰ Ã— çœ¼",
  "çš‡å¸æ‰‹":"å”‡ç‚ºä¸» Ã— çœ‰ç‚ºè¼”",
  "çš‡å¸è…¹":"å”‡ Ã— çœ¼",
  "çš‡å¸è†":"çœ‰ç‚ºä¸»",
  "çš‡å¸è¶³":"çœ¼ Ã— å”‡",
  "çš‡å¸è…°":"çœ‰ Ã— å”‡"
};

const explain = {
  "çš‡å¸é ­":{title:"è¡£é£Ÿç„¡æ†‚",keywords:["å…ˆå¤©è³‡æº","ç”Ÿæ´»å®‰ç©©","ç¦æ°£å»¶çºŒ"],paras:["ç”Ÿåœ¨çš‡å¸é ­çš„äººï¼Œæˆé•·æœŸé–“å¤šåŠé¢¨å¹³æµªéœã€è¡£é£Ÿç„¡æ†‚ï¼Œç¦æ°£å¾€å¾€èƒ½å»¶çºŒä¸€ç”Ÿã€‚","ä½†ä¹Ÿå› æ¢ä»¶è¼ƒé †ï¼Œå®¹æ˜“å°‘äº†è¡å‹ï¼›è‹¥ä½ é¡˜æ„å†åŠªåŠ›ä¸€é»ï¼ŒæˆåŠŸæ©Ÿæœƒå¾€å¾€æ¯”ä¸€èˆ¬äººæ›´é«˜ã€‚"],teacher:"è€å¸«æé†’ï¼šä½ ä¸æ˜¯ä¸å¤ å¼·ï¼Œåªæ˜¯åˆ¥å¿˜äº†æŠŠå¤©è³¦æ‹¿å‡ºä¾†ç”¨ã€‚"},
  "çš‡å¸æ‰‹":{title:"è²¡æºä¸çµ•",keywords:["å¯¦å¹¹å‹","äº¤éš›æ‰‹è…•","é©åˆæ¥­å‹™/å‰µæ¥­"],paras:["ä½ é è¡Œå‹•èˆ‡äººéš›æŠŠæˆæœåšå‡ºä¾†ï¼Œè²¡æºä¹Ÿæ›´å®¹æ˜“è¢«ä½ æ¡åœ¨æ‰‹ä¸Šã€‚","æ—©å¹´å¤šåŠå¹³å¯¦ï¼Œä½†è‹¥åŠæ—©æ‰¾åˆ°å°ˆé•·ä¸¦å …å®šå‰é€²ï¼Œè¶Šåˆ°å¾Œé¢è¶Šèƒ½è¡£é£Ÿç„¡æ†‚ã€‚"],teacher:"è€å¸«æé†’ï¼šä½ å¾ˆæœƒä»˜å‡ºï¼Œä¹Ÿè¦è¨˜å¾—è®“æˆæœå›åˆ°è‡ªå·±èº«ä¸Šã€‚"},
  "çš‡å¸è‚©":{title:"ä¸­å¹´è½‰å¥½",keywords:["å¥”æ³¢å‹å¿ƒ","ä¸­å¹´è½‰é †","è¦ªå‹åŠ©åŠ›"],paras:["æ—©å¹´ä¸è‡³æ–¼å·®ï¼Œä½†å¸¸èº«å¿ƒå‹ç´¯ã€å››è™•å¥”æ³¢ï¼›ä¸­å¹´å¾Œéš›é‡æ›´å®¹æ˜“å¤§å¹…è½‰å¥½ã€‚","è‹¥å–„ç”¨åˆä½œå„ªå‹¢ï¼ŒæŠŠåˆä½œç”¨åœ¨å°çš„äººèˆ‡å°çš„äº‹ä¸Šï¼ŒæˆåŠŸæ›´å®¹æ˜“è¢«æ”¾å¤§ã€‚"],teacher:"è€å¸«æé†’ï¼šä½ æœƒè¶Šèµ°è¶Šé †ï¼Œé—œéµæ˜¯ã€é—œä¿‚èµ°ç©©ã€ã€‚"},
  "çš‡å¸è†":{title:"ä¸€ç”Ÿå‹ç¢Œ",keywords:["å°‘åè²¡é‹","é åŠªåŠ›ç´¯ç©","å¾Œå‹å¼·"],paras:["å¥½é‹ä¸å¤ªæœƒçªç„¶é™è‡¨ï¼Œä½ å¾—åˆ°çš„å¤šé æ¯”åˆ¥äººæ›´å¤šçš„åŠªåŠ›æ›ä¾†ã€‚","ä½†ä¹Ÿå› ç£¨ç·´å¤šï¼Œä½ çš„æ¯…åŠ›å¾€å¾€æ›´å¼·ï¼›æ™šå¹´æœ‰æ©Ÿæœƒæ…¢æ…¢è½‰å¥½ã€‚"],teacher:"è€å¸«æé†’ï¼šä½ ä¸æ˜¯å‘½å·®ï¼Œä½ æ˜¯ã€è¶Šèµ°è¶Šç©©ã€è¶Šç£¨è¶Šå¼·ã€çš„å‘½ã€‚"},
  "çš‡å¸è¶³":{title:"ä»–é„‰ç™¼å±•",keywords:["é è‡ªå·±","å¤–åœ°è½‰é‹","ç•™æ„æºé€š"],paras:["äººç”Ÿå¤šé è‡ªå·±æ±ºå®šæˆæ•—ï¼›èµ°å‡ºå»åˆ°å¤–åœ°ç™¼å±•ï¼Œåè€Œæ›´å®¹æ˜“è½‰é‹ã€‚","æ„Ÿæƒ…ä¸Šè¨˜å¾—æ…¢ä¸€é»èªªï¼Œç·£åˆ†æ›´ç©©ã€‚"],teacher:"è€å¸«æé†’ï¼šä½ çš„è·¯ä¸åœ¨åŸåœ°ï¼Œåœ¨ä½ é¡˜æ„èµ°å‡ºå»çš„åœ°æ–¹ã€‚"},
  "çš‡å¸è…°":{title:"é›†è¬åƒå¯µæ„›",keywords:["è²´äººæ‰¶æŒ","ä¸­å¹´ç©©å¯Œ","è¦ç·´æŠ—å£“"],paras:["è³‡æºèˆ‡è²´äººé‹ä¸å·®ï¼Œä¸­å¹´å¾Œæ›´å®¹æ˜“ç©©å®šå¯Œè¶³ã€‚","è¦ç•™æ„åˆ¥æˆäº†æº«å®¤èŠ±æœµï¼›ç£¨ç·´å¿ƒæ€§èˆ‡æ„å¿—åŠ›ï¼Œæˆå°±æœƒä¾†å¾—æ›´å¿«ã€‚"],teacher:"è€å¸«æé†’ï¼šä½ çš„å‘½å¾ˆå¥½ï¼ŒæŠŠè‡ªå·±ç·´å¼·ä¸€é»ï¼Œè²´æ°£æ‰ç•™å¾—ä½ã€‚"},
  "çš‡å¸è…¹":{title:"è°æ˜æ‰æ™ºæ˜“æˆåŠŸ",keywords:["è…¦ç­‹éˆæ´»","è¿½æ±‚å“è¶Š","è…³è¸å¯¦åœ°æ›´ä¹…"],paras:["ä½ è…¦ç­‹éˆæ´»ã€æ‰æ°£ä¸ä¿—ï¼Œç‰¹åˆ¥å®¹æ˜“åœ¨å·¥ä½œä¸Šç™¼å…‰ã€‚","åªè¦ä½ é¡˜æ„è…³è¸å¯¦åœ°ï¼Œæˆå°±æœƒæ›´å¤§ä¹Ÿæ›´æŒä¹…ï¼Œè²¡å¯Œä¹Ÿä¸æœƒå°‘ã€‚"],teacher:"è€å¸«æé†’ï¼šæŠŠè°æ˜è½åœ°ï¼Œä½ å°±æœƒèµ°å¾—åˆç©©åˆé ã€‚"}
};

const seasonText = { spring:"æ˜¥å­£", summer:"å¤å­£", autumn:"ç§‹å­£", winter:"å†¬å­£" };

/** âœ… é‡è¦ï¼šæŠŠè¼¸å…¥å…ˆè¨˜ä½ï¼Œå›ä¾†ä¸æœƒç©ºæ‰ */
const INPUT_KEY = "gbeauty_emperor_inputs_v1";

/** âœ… æäº¤ç´€éŒ„ï¼ˆ24 å°æ™‚ï¼‰ */
const SUBMIT_KEY = "gbeauty_emperor_submitted_until";

function esc(s){
  return String(s).replaceAll("&","&amp;").replaceAll("<","&lt;").replaceAll(">","&gt;")
    .replaceAll('"',"&quot;").replaceAll("'","&#39;");
}

function getInputs(){
  const name = document.getElementById("custName").value.trim();
  const s = document.getElementById("season").value;
  const t = document.getElementById("time").value;
  return {name,s,t};
}

function saveInputsToLocal(){
  const {name,s,t} = getInputs();
  localStorage.setItem(INPUT_KEY, JSON.stringify({name,s,t, ts: Date.now()}));
}

function restoreInputsFromLocal(){
  try{
    const raw = localStorage.getItem(INPUT_KEY);
    if(!raw) return;
    const data = JSON.parse(raw);
    if(!data) return;
    if(typeof data.name === "string") document.getElementById("custName").value = data.name;
    if(typeof data.s === "string") document.getElementById("season").value = data.s;
    if(typeof data.t === "string") document.getElementById("time").value = data.t;
  }catch(e){}
}

function buildPrefillUrl(name,s,t){
  const part = table[s]?.[t];
  const consult = consultMap[part] || "";
  return FORM_BASE
    .replace("NAME", encodeURIComponent(name))
    .replace("SEASON", encodeURIComponent(seasonText[s]))
    .replace("TIME", encodeURIComponent(t + "æ™‚"))
    .replace("PART", encodeURIComponent(part || ""))
    .replace("CONSULT", encodeURIComponent(consult));
}

function renderResult(name,s,t){
  const part = table[s]?.[t];
  if(!part){
    alert("è€å¸«å°æé†’ï¼šä½ é¸çš„å­£ç¯€/æ™‚è¾°æ²’æœ‰å°åˆ°çµæœï¼Œè«‹å†ç¢ºèªä¸€æ¬¡ğŸ™‚");
    return;
  }
  const consult = consultMap[part] || "";
  const ex = explain[part];

  const keywordHtml = (ex.keywords||[]).map(k => `<span class="pill">${esc(k)}</span>`).join("");
  const parasHtml = (ex.paras||[]).map(p => `<p>${esc(p)}</p>`).join("");

  const box = document.getElementById("result");
  box.innerHTML = `
    <div class="badge">æ¸¬é©—çµæœ</div>
    <h2>${esc(name)}ï¼Œä½ ç”Ÿåœ¨ã€${esc(part)}ã€‘ï½œ${esc(ex.title)}</h2>
    <div class="k">${keywordHtml}</div>

    <p style="margin-top:10px; color:#6b7280; font-size:13px;">
      ä½ çš„é¸æ“‡ï¼š${esc(seasonText[s])}ãƒ»${esc(t)}æ™‚
    </p>

    <p><span class="pill">é©åˆçš„è«®è©¢æ–¹å‘ï¼š${esc(consult)}</span></p>

    ${parasHtml}

    <div class="note">
      ${esc(ex.teacher)}<br>
      è€å¸«æƒ³è£œä¸€å¥ï¼šä½ é¡˜æ„äº†è§£è‡ªå·±ï¼Œå°±æ˜¯åœ¨æŠŠäººç”Ÿæ…¢æ…¢æ•´ç†å›ä¾†ã€‚
    </div>

    <div class="ctaRow">
      <a class="btn primary" href="booking.html#bookingForm">æƒ³æ›´ç´°ç·»åˆ¤è®€ï¼Œç›´æ¥é ç´„</a>
      <a class="btn" href="vip.html">çœ‹ VIP çŸ©é™£ç¸½èªªï¼ˆéœ€å¯†ç¢¼ï¼‰</a>
      <a class="btn" href="./">å›é¦–é </a>
    </div>
  `;
  box.style.display = "block";
  box.scrollIntoView({behavior:"smooth"});
}

function setStatus(msg){
  document.getElementById("statusText").textContent = msg || "";
}

function enableRevealButton(){
  document.getElementById("btnAlready").disabled = false;
}

/** âœ… ä»»ä½•è¼¸å…¥è®Šå‹•ï¼Œéƒ½å…ˆå­˜èµ·ä¾†ï¼ˆå›ä¾†ä¸æœƒç©ºï¼‰ */
["custName","season","time"].forEach(id=>{
  const el = document.getElementById(id);
  el.addEventListener("input", saveInputsToLocal);
  el.addEventListener("change", saveInputsToLocal);
});

/** â‘  å„²å­˜ä¸¦æ­æ›‰ï¼šå…ˆæ‰“é–‹è¡¨å–® */
function saveAndReveal(){
  const {name,s,t} = getInputs();
  if(!name){ alert("è«‹å…ˆè¼¸å…¥å§“åï¼Œæ–¹ä¾¿æˆ‘ç‚ºä½ è¨˜éŒ„ğŸ™‚"); return; }
  if(!s || !t){ alert("è«‹å®Œæ•´é¸æ“‡å­£ç¯€èˆ‡æ™‚è¾°"); return; }

  saveInputsToLocal(); // âœ…å…ˆè¨˜ä½

  const url = buildPrefillUrl(name,s,t);
  window.open(url, "_blank", "noopener");

  setStatus("âœ… æˆ‘å·²æŠŠè¡¨å–®æ›¿ä½ å¡«å¥½ä¸¦é–‹å•Ÿï¼›ä½ åªè¦æŒ‰ä¸€æ¬¡ã€Œæäº¤ã€ï¼Œæˆ‘å°±èƒ½æŠŠçµæœå®Œæ•´ç•™å­˜ã€‚æäº¤å¾Œå›ä¾†æŒ‰ã€Œæˆ‘å·²æäº¤ï¼Œé¡¯ç¤ºçµæœã€ã€‚");
  enableRevealButton(); // âœ…å…ˆè§£é–
}

/** â‘¡ ä½¿ç”¨è€…å›ä¾†æŒ‰ï¼šæˆ‘å·²æäº¤ï¼ˆâœ… å„€å¼æ–‡å­— + 3 ç§’å¾Œæ­æ›‰ï¼‰ */
function confirmSubmitted(){
  // âœ…å„ªå…ˆç”¨ç›®å‰æ¬„ä½ï¼›è‹¥ç©ºäº†å°±å¾ localStorage å–å›
  let {name,s,t} = getInputs();
  if(!name || !s || !t){
    restoreInputsFromLocal();
    ({name,s,t} = getInputs());
  }

  if(!name || !s || !t){
    alert("è€å¸«å°æé†’ï¼šå›ä¾†å¾Œæ¬„ä½è¢«æ¸…ç©ºäº†ï¼Œè«‹å†è¼¸å…¥å§“åã€å­£ç¯€ã€æ™‚è¾°ğŸ™‚");
    return;
  }

  const until = Date.now() + 24*60*60*1000;
  localStorage.setItem(SUBMIT_KEY, String(until));
  saveInputsToLocal();

  const ritual = document.getElementById("ritualText");
  const loader = document.getElementById("loader");
  const result = document.getElementById("result");

  ritual.style.display = "block";
  loader.style.display = "flex";
  result.style.display = "none";
  ritual.scrollIntoView({behavior:"smooth"});

  setTimeout(() => {
    ritual.style.display = "none";
    loader.style.display = "none";
    renderResult(name,s,t);
  }, 3000);
}

function autoRevealIfRecentlySubmitted(){
  restoreInputsFromLocal(); // âœ…å›åˆ°é é¢å°±å…ˆæŠŠæ¬„ä½è£œå›ä¾†

  const until = Number(localStorage.getItem(SUBMIT_KEY) || "0");
  // âœ…åªè¦æœ‰å¡«éè³‡æ–™ï¼Œå°±ç›´æ¥æŠŠæŒ‰éˆ•é–‹èµ·ä¾†ï¼ˆé¿å…å›ä¾†æŒ‰ä¸äº†ï¼‰
  const {name,s,t} = getInputs();
  if(name && s && t) enableRevealButton();

  if(until && until > Date.now()){
    enableRevealButton();
    setStatus("ä½ æœ€è¿‘å·²å®Œæˆæäº¤ğŸ™‚ å¦‚æœè¦ç›´æ¥çœ‹çµæœï¼ŒæŒ‰ã€Œæˆ‘å·²æäº¤ï¼Œé¡¯ç¤ºçµæœã€ã€‚");
  }else if(name && s && t){
    setStatus("å¡«å¥½å¾Œå¯æŒ‰ã€Œå„²å­˜ä¸¦æ­æ›‰ã€ã€‚æäº¤å®Œæˆå›ä¾†ï¼ŒæŒ‰ã€Œæˆ‘å·²æäº¤ï¼Œé¡¯ç¤ºçµæœã€ã€‚");
  }
}

autoRevealIfRecentlySubmitted();
</script>

</body>
</html>
